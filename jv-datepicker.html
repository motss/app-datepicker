<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="jv-datepicker-icons.html">
<link rel="import" href="datepicker-slide-from-left-animation.html">
<link rel="import" href="datepicker-slide-from-right-animation.html">

<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../iron-list/iron-list.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../neon-animation/neon-animated-pages.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-right-animation.html">

<!--
Material Design: [Pickers](https://www.google.com/design/spec/components/pickers.html#pickers-date-pickers)

An custom Polymer element created to provide a datepicker element that is more compelling and rich with features.

Example:

    <jv-datepicker><jv-datepicker>
    <jv-datepicker-dialog></jv-datepicker-dialog>
    <jv-datepicker-dialog modal></jv-datepicker-dialog>
    <jv-datepicker-dialog with-backdrop></jv-datepicker-dialog>
    <jv-datepicker view="horizontal"></jv-datepicker>
    <jv-datepicker theme="dark-theme"></jv-datepicker>

`jv-datepicker` provides a regular datepicker element.
While `jv-datepicker-dialog` has a `jv-datepicker` being wrapped inside a dialog.

~~### ( Coming soon!) Generating your own boilerplate code of the element `jv-datepicker` or `jv-datepicker-dialog`~~

~~At the end of the demo, there is a section where user can play around with to generate your own boilerplate code with the attributes provided. Let's go and check out the demo!~~

### Styling

By default, the datepicker is in `light-theme` and now you are able to style almost all possible sections of the datepicker with your own choices of color.

**__ ** Note: As of release v2.4.0 the datepicker includes some basic themes that can be set via `theme` property: `dark-theme`, `light-theme`, or `goog-theme`.__*

Style the datepicker with CSS as you would a normal DOM element.

    jv-datepicker-dialog#darkThemedDialog {
      background: #424242;
      --jv-datepicker-bg: #424242;
      --jv-datepicker-selection-bg: #555555;
      --jv-datepicker-selection-color: #cccccc;
      --jv-datepicker-iron-selected: #FFFFFF;
      --jv-datepicker-calendar-bg: #424242;
      --jv-datepicker-calendar-color: #ffffff;
      --jv-datepicker-weekdays-color: #c6c6c6;
      --jv-datepicker-selected-day-bg: #80CBC4;
      --jv-datepicker-selected-day-color: #555555;
      --jv-datepicker-selected-year-bg: #f5f5f5;
      --jv-datepicker-selected-year-color: #80CBC4;
      --jv-datepicker-today-color: #80CBC4;
      --jv-datepicker-disabled-color: #ffff00;
      --jv-datepicker-icon-button-color: #ffff00;
      --jv-datepicker-icon-button-ink-color: #ffff00;
      --jv-datepicker-button-color: #80CBC4;
      --jv-datepicker-button-ink-color: #bcbcbc;
    }

The following custom properties and mixin are also available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--jv-datepicker-bg` | Background color of the datepicker | #fafafa
`--jv-datepicker-selection-bg` | Background color of the display section (selectionView) | #009688
`--jv-datepicker-selection-color` | Text color of the display section (selectionView) | #b2dfdb
`--jv-datepicker-iron-selected` | Text color of the view selector | #fefefe
`--jv-datepicker-calendar-bg` | Background color of calendar section | #fafafa
`--jv-datepicker-calendar-color` | Text color of calendar section | #000
`--jv-datepicker-weekdays-color` | Text color of weekdays | #9b9b9b
`--jv-datepicker-selected-day-bg` | Background color of selected day | #009688
`--jv-datepicker-selected-day-color` | Text color of selected day | #fff
`--jv-datepicker-selected-year-bg` | Background color of selected year in year list | #f5f5f5
`--jv-datepicker-selected-year-color` | Text color of selected year in year list | #009688
`--jv-datepicker-today-color` | Text color of today's day | #009688
`--jv-datepicker-disabled-color` | Text color of disabled days | #9e9e9e
`--jv-datepicker-icon-buttons-color` | Text color of `paper-icon-button` | #737373
`--jv-datepicker-icon-button-ink-color` | Ink color of `paper-icon-button` | #737373
`--jv-datepicker-button-color` | Color of `paper-button` | #009688
`--jv-datepicker-button-ink-color` | Ink color of `paper-button` | #737373
`--jv-datepicker` | Mixin applied to the datepicker | {}
`--jv-datepicker-buttons` | Mixin applied to the datepicker's buttons | {}

`--jv-datepicker-selected-year` | Mixin applied to the datepicker's selected year | {}
`--jv-datepicker-selected-date` | Mixin applied to the datepicker's selected date | {}
`--jv-datepicker-nav-month-year` | Mixin applied to the datepicker's nav-month-year | {}
`--jv-datepicker-days-of-week` | Mixin applied to the datepicker's days-of-week | {}
`--jv-datepicker-days-of-month` | Mixin applied to the datepicker's days-of-month | {}
`--jv-datepicker-each-list-of-years` | Mixin applied to the datepicker's each-list-of-years | {}

@author motss
@element jv-datepicker, jv-datepicker-dialog
@demo demo/index.html
-->
<dom-module id="jv-datepicker">
  <template strip-whitespace>
    <style>
      :host {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        box-sizing: border-box;

        background: var(--jv-datepicker-bg, #fafafa);
        @apply(--jv-datepicker);
        display: block;
      }

      * {
        box-sizing: inherit;
      }

      div.datepicker {
        /* calc(300px + 84px) */
        position: relative;
        width: 300px;
        height: 384px;
        max-height: 384px;
        @apply(--layout-vertical);
      }
      div.datepicker.with-buttons {
        /* calc(300px + 84px + 47px) */
        height: 431px;
        max-height: 431px;
      }

      iron-selector.selected-fulldate {
        min-height: 84px;
        padding: 8px 24px;
        color: var(--jv-datepicker-selection-color, #b2dfdb);
        background-color: var(--jv-datepicker-selection-bg, #009688);
        @apply(--layout-vertical);
      }
      div.selected-year.iron-selected,
      div.selected-date.iron-selected {
        color: var(--jv-datepicker-iron-selected, #fefefe);
      }
      div.selected-year {
        font-size: 14px;
        font-weight: 800;
        height: 34px;
        cursor: pointer;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--jv-datepicker-selected-year);
      }
      div.selected-date {
        font-size: 32px;
        font-weight: 800;
        height: 34px;
        cursor: pointer;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--jv-datepicker-selected-date);
      }

      neon-animated-pages.fullcalendar {
        width: 100%;
        height: 100%;
        overflow: hidden;
        color: var(--jv-datepicker-calendar-color, #000);
        background-color: var(--jv-datepicker-calendar-bg, #fafafa);
        @apply(--layout-vertical);
      }
      div.navigator {
        max-height: 46px;
        padding: 3px 10px;
        position: relative;
        margin-top: 8px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }
      div.nav-month-year {
        font-size: 14px;
        font-weight: 500;
        text-align: center;
        @apply(--layout-flex-auto);
        @apply(--jv-datepicker-nav-month-year);
      }
      div.days-of-week {
        color: var(--jv-datepicker-weekdays-color, #848484);
        font-size: 12px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--jv-datepicker-days-of-week);
      }
      div.each-days-of-week {
        padding: 13px;
        max-height: 32px;
        width: 41px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }
      div.days-of-month {
        /*padding-bottom: 8px;*/
        font-size: 13px;
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-center-justified);
        @apply(--jv-datepicker-days-of-month);
      }
      div.each-days-of-month {
        height: 35px;
        width: 35px;
        margin-left: 3px;
        margin-right: 3px;
        position: relative;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }
      div > div.days-of-month > div.each-days-of-month.chosen-days-of-month {
        border-radius: 50%;
        background-color: var(--jv-datepicker-selected-day-bg, #009688);
        color: var(--jv-datepicker-selected-day-color, #fff);
      }
      div.days-of-month > div.each-days-of-month.is-today {
        color: var(--jv-datepicker-today-color, #009688);
      }
      div.days-of-month > .each-days-of-month.is-disabled-day {
        color: var(--jv-datepicker-disabled-color, #9e9e9e);
      }
      div.each-days-of-month:not(.is-non-selectable) {
        cursor: pointer;
      }

      div.each-list-of-years {
        height: 64px;
        font-size: 16px;
        cursor: pointer;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--jv-datepicker-each-list-of-years);
      }
      div.each-list-of-years.is-selected {
        background-color: var(--jv-datepicker-selected-year-bg, #f5f5f5);
        color: var(--jv-datepicker-selected-year-color, #009688);
        font-weight: 800;
      }

      /* paper-icon-button */
      paper-icon-button {
        color: var(--jv-datepicker-icon-button-color, #737373);
        --paper-icon-button-ink-color: var(--jv-datepicker-icon-button-ink-color, #737373);
      }

      /* content tag selector */
      div.calendar-view > ::content > div.buttons {
        color: var(--jv-datepicker-button-color, #009688);
        --paper-button-ink-color: var(--jv-datepicker-button-ink-color, #737373);
        position: relative;
        padding: 8px 8px 8px 24px;
        margin: 0;
        font-size: 12px;
        font-weight: 500;
        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
        @apply(--jv-datepicker-buttons);
      }

      /* will-change: transform, however lag on the first time */
      div.nav-month-year,
      div.days-of-week,
      div.days-of-month {
        will-change: transform;
        -webkit-transform: translate3d(0px, 0px, 0px);
                transform: translate3d(0px, 0px, 0px);
        -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
      }

      iron-list {
        --iron-list-items-container: {
          -webkit-transform: translate3d(0px, 0px, 0px);
          transform: translate3d(0px, 0px, 0px);
          -webkit-backface-visibility: hidden;
          backface-visibility: hidden;
        };
      }

      /* landscape */
      @media all and (orientation: landscape) {
        :host(:not(.vertical-view)) div#dp.datepicker {
          width: 512px;
          /* calc(288px - 47px) */
          height: 241px;
          @apply(--layout-horizontal);
        }
        :host(:not(.vertical-view)) div#dp.datepicker.with-buttons {
          height: 288px;
        }

        :host(:not(.vertical-view)) iron-selector.selected-fulldate {
          /* Fixed for IE11, Edge */
          min-width: 164px;
          width: 100%;
          max-width: 164px;
          height: 100%;
        }
        :host(:not(.vertical-view)) div.selected-date {
          height: 68px;
          @apply(--layout-vertical);
          @apply(--layout-start);
          @apply(--layout-center-justified);
        }
        /* Fixed for IE11, Edge */
        :host(:not(.vertical-view)) div.selected-date > span {
          max-width: 100%;
          word-wrap: break-word;
        }

        :host(:not(.vertical-view)) neon-animated-pages.fullcalendar {
          height: 100%;
        }
        :host(:not(.vertical-view)) div.calendar-view {
          padding-bottom: 0;
        }
        :host(:not(.vertical-view)) div.navigator {
          padding: 2px 10px;
          margin-top: 0;
        }
        :host(:not(.vertical-view)) div.each-days-of-week {
          width: calc(100% / 7 - 20px);
          padding: 0;
          margin-left: 10px;
          margin-right: 10px;
        }
        :host(:not(.vertical-view)) div.days-of-month {
          margin-top: 8px;
        }

        :host(:not(.vertical-view)) div.each-days-of-month {
          height: 29px;
          margin-left: 10px;
          margin-right: 10px;
          width: calc(100% / 7 - 20px);
        }
      }

      /* view=horizontal */
      :host(.horizontal-view) div#dp.datepicker {
        width: 512px;
        /* calc(288px - 47px) */
        height: 241px;
        @apply(--layout-horizontal);
      }
      :host(.horizontal-view) div#dp.datepicker.with-buttons {
        height: 288px;
      }

      :host(.horizontal-view) iron-selector.selected-fulldate {
        width: calc(100% / 3 + 48px);
        height: 100%;
      }
      :host(.horizontal-view) div.selected-date {
        height: 68px;
        @apply(--layout-vertical);
        @apply(--layout-start);
        @apply(--layout-center-justified);
      }

      :host(.horizontal-view) neon-animated-pages.fullcalendar {
        height: 100%;
      }
      :host(.horizontal-view) div.calendar-view {
        padding-bottom: 0;
      }
      :host(.horizontal-view) div.navigator {
        padding: 2px 10px;
        margin-top: 0;
      }
      :host(.horizontal-view) div.each-days-of-week {
        width: calc(100% / 7 - 20px);
        padding: 0;
        margin-left: 10px;
        margin-right: 10px;
      }
      :host(.horizontal-view) div.each-days-of-month {
        height: 29px;
        margin-left: 10px;
        margin-right: 10px;
        width: calc(100% / 7 - 20px);
      }

      /* dark-theme */
      :host(.dark-theme) {
        background-color: var(--jv-datepicker-bg, #424242);
      }

      :host(.dark-theme) iron-selector.selected-fulldate {
        color: var(--jv-datepicker-selection-color, #9e9e9e);
        background-color: var(--jv-datepicker-selection-bg, #555);
      }
      :host(.dark-theme) div.selected-year.iron-selected,
      :host(.dark-theme) div.selected-date.iron-selected {
        color: var(--jv-datepicker-iron-selected, #f5f5f5);
      }
      :host(.dark-theme) neon-animated-pages.fullcalendar {
        color: var(--jv-datepicker-calendar-color, #f5f5f5);
        background-color: var(--jv-datepicker-calendar-bg, #424242);
      }
      :host(.dark-theme) div.days-of-week {
        color: var(--jv-datepicker-weekdays-color, #7c7c7c);
      }
      :host(.dark-theme) div > div.days-of-month > div.each-days-of-month.chosen-days-of-month {
        color: var(--jv-datepicker-selected-day-color, #555);
        background-color: var(--jv-datepicker-selected-day-bg, #80cbc4);
      }
      :host(.dark-theme) div.days-of-month > div.each-days-of-month.is-today {
        color: var(--jv-datepicker-today-color, #80cbc4);
      }
      :host(.dark-theme) div.days-of-month > .each-days-of-month.is-disabled-day {
        color: var(--jv-datepicker-disabled-color, #ffff00);
      }
      :host(.dark-theme) div.each-list-of-years.is-selected {
        background-color: var(--jv-datepicker-selected-year-bg, rgba(0, 0, 0, 0));
        color: var(--jv-datepicker-selected-year-color, #80cbc4);
        font-size: 26px;
        font-weight: 500;
      }
      :host(.dark-theme) paper-icon-button {
        color: var(--jv-datepicker-icon-button-color, #ffff00);
        --paper-icon-button-ink-color: var(--jv-datepicker-icon-button-ink-color, #212121);
      }
      :host(.dark-theme) div.calendar-view > ::content > div.buttons > paper-button {
        color: var(--jv-datepicker-button-color, #80cbc4);
        --paper-button-ink-color: var(--jv-datepicker-button-ink-color, #bcbcbc);
      }

      /* goog theme */
      :host(.goog-theme) {
        background-color: var(--jv-datepicker-bg, #212121);
      }

      :host(.goog-theme) iron-selector.selected-fulldate {
        color: var(--jv-datepicker-selection-color, #fff);
        background-color: var(--jv-datepicker-selection-bg, #212121);
      }
      :host(.goog-theme) div.selected-year.iron-selected,
      :host(.goog-theme) div.selected-date.iron-selected {
        color: var(--jv-datepicker-iron-selected, #DA4336);
      }
      :host(.goog-theme) neon-animated-pages.fullcalendar {
        color: var(--jv-datepicker-calendar-color, #fff);
        background-color: var(--jv-datepicker-calendar-bg, #212121);
      }
      :host(.goog-theme) div.days-of-week {
        color: var(--jv-datepicker-weekdays-color, #9e9e9e);
      }
      :host(.goog-theme) div > div.days-of-month > div.each-days-of-month.chosen-days-of-month {
        color: var(--jv-datepicker-selected-day-color, #fff);
        background-color: var(--jv-datepicker-selected-day-bg, #DA4336);
      }
      :host(.goog-theme) div.days-of-month > div.each-days-of-month.is-today {
        color: var(--jv-datepicker-today-color, #DA4336);
      }
      :host(.goog-theme) div.days-of-month > .each-days-of-month.is-disabled-day {
        color: var(--jv-datepicker-disabled-color, #646464);
      }
      :host(.goog-theme) div.each-list-of-years.is-selected {
        background-color: var(--jv-datepicker-selected-year-bg, rgba(0, 0, 0, 0));
        color: var(--jv-datepicker-selected-year-color, #DA4336);
        font-size: 26px;
        font-weight: 500;
      }
      :host(.goog-theme) paper-icon-button {
        color: var(--jv-datepicker-icon-button-color, #DA4336);
        --paper-icon-button-ink-color: var(--jv-datepicker-icon-button-ink-color, #616161);
      }
      :host(.goog-theme) div.calendar-view > ::content > div.buttons > paper-button {
        color: var(--jv-datepicker-button-color, #DA4336);
        --paper-button-ink-color: var(--jv-datepicker-button-ink-color, #616161);
      }

    </style>

    <div id="dp" class="datepicker">
      <iron-selector selected="{{_activeView}}" class="selected-fulldate" attr-for-selected="view" on-selected-changed="_onIronSelectorSelectedChanged">
        <div class="selected-year" view="year">
          [[_showSelectedYear]]
        </div>
        <div class="selected-date" view="calendar">
          <span>[[_shortSelectedDate]]</span>
        </div>
      </iron-selector>

      <neon-animated-pages class="fullcalendar" selected="[[_activeView]]" attr-for-selected="view" entry-animation="[[pageEntryAnimation]]" exit-animation="[[pageExitAnimation]]" on-neon-animation-finish="_onAnimationFinish">
        <div class="calendar-view" view="calendar">
          <div class="navigator">
            <paper-icon-button icon="datepicker:chevron-left" on-transitionend="_decrementMonth" on-tap="_decrementMonth" noink="[[noAnimation]]"></paper-icon-button>
            <div id="navMonthYear" class="nav-month-year">
              [[_activeMonthYear]]
            </div>
            <paper-icon-button icon="datepicker:chevron-right" on-transitionend="_incrementMonth" on-tap="_incrementMonth" noink="[[noAnimation]]"></paper-icon-button>
          </div>

          <div id="daysOfWeek" class="days-of-week">
            <template is="dom-repeat" items="[[_daysOfWeek]]" index-as="index" strip-whitespace>
              <div class="each-days-of-week">
                [[item]]
              </div>
            </template>
          </div>

          <div id="daysOfMonth" class="days-of-month" on-tap="_chooseDaysOfMonth">
            <template is="dom-repeat" items="[[_daysOfMonth]]" index-as="index" strip-whitespace>
              <div class$="each-days-of-month[[_isToday(item.index, _activeYear, _activeMonth)]][[_isEmptyDate(item.index)]][[_isChosenDaysOfMonth(item.index, _selectedYear, _selectedMonth, _selectedDate)]][[_isDisableDays(index, _shiftedDisableDays.*, firstDayOfWeek, minDate, maxDate, item.index)]]" index="[[index]]" date="[[item.index]]">
                [[item.date]]
              </div>
            </template>
          </div>

          <content select=".buttons"></content>
        </div>

        <template is="dom-if" if="[[_isListRendered]]" restamp="true" strip-whitespace on-dom-change="_onListRendered">
          <iron-list  id="listOfYears" items="[[_listOfYears]]" view="year" on-neon-animation-finish="_onAnimationFinish">
            <template>
              <div class$="each-list-of-years[[_isListOfYearsSelected(item.year, _activeYear)]]" tabindex$="[[tabIndex]]" aria-label$="[[item.year]]" label$="[[item.year]]" on-tap="_goCalendar">
                [[item.year]]
              </div>
            </template>
          </iron-list>
        </template>
      </neon-animated-pages>

    </div>
  </template>

  <script>
    Polymer({
      is: 'jv-datepicker',

      hostAttributes: {
        role: 'datepicker',
      },

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        /**
         * Set locale for the datepicker.
         */
        locale: {
          type: String,
          value: function() {
            if (window.Intl) {
              return new window.Intl.DateTimeFormat().resolvedOptions().locale;
            }
          }
        },
        /**
         * This forcefully sets the view of the datepicker without respecting the orientation of the device.
         * Available options: `vertical`, `horizontal`.
         */
        view: String,
        /**
         * This is used to set a theme for the datepicker. By default, the `light-theme` is applied.
         * Other options are `dark-theme`, `goog-theme`.
         */
        theme: String,
        /**
         * First Day of the week. Numbered days: `0 (Sun)` to `6 (Sat)`.
         */
        firstDayOfWeek: {
          type: Number,
          value: 0
        },
        /**
         * Arrays of days need to be disabled for selection, numbered from
         * `0 (Sun)` to `6 (Sat)`. Eg. weekends, `disable-days="[0, 6]"`.
         */
        disableDays: {
          type: Array,
          value: function() {
            return [6, 0];
          }
        },
        /**
         * Minimum date for selection. Dates that are smaller than the minimum
         * date will be disabled for selection.
         */
        minDate: {
          type: String,
          value: '1000/00/01'
        },
        /**
         * Maximum date for selection. Dates that are larger than the maximum
         * date will be disabled for selection.
         */
        maxDate: {
          type: String,
          value: '9999/99/99'
        },
        /**
         * Format for the selected date. Default to `yyyy/mm/dd`. Eg. `2017/05/17`.
         */
        format: {
          type: String,
          value: 'yyyy/mm/dd'
        },
        /**
         * Selected date in the default format of `yyyy/mm/dd`. Eg. `2017/05/17`.
         */
        date: {
          type: String,
          notify: true,
          readOnly: true
        },
        /**
         * inputDate accepts a standard date string. It will reflect the change to update the internal.
         */
        inputDate: String,
        /**
        * If true, no animation and transition on all elements.
        */
        noAnimation: Boolean,
        /**
        * Custom animation effect property when the page enters.
        */
        pageEntryAnimation: String,
        /**
        * Custom animation effect when the page exits.
        */
        pageExitAnimation: String,
        /**
         * Selected date will be formatted into long date. Eg. `Fri, May 12 2017`.
         */
        showLongDate: {
          type: Boolean,
          value: !1
        },
        /**
         * To indicate the input date is in an invalid format hence no date change is applied. Only use this with inputDate property.
         */
        invalidDate: {
          type: Boolean,
          notify: true,
          readOnly: true
        },

        // month names, literally.
        _monthNames: {
          type: Array,
          value: function() {
            return [ 'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December' ];
          }
        },

        _shiftedDisableDays: {
          type: Array,
          value: [6, 0]
        },

        _activeMonthYear: String,
        _shortSelectedDate: String,
        _showSelectedYear: String,

        _daysOfWeek: Array,
        _daysOfMonth: Array,
        _listOfYears: Array,

        _activeView: {
          type: String,
          value: 'calendar'
        },
        _activeYear: {
          type: Number,
          value: function() {
            return new Date().getFullYear();
          }
        },
        _activeMonth: {
          type: Number,
          value: function() {
            return new Date().getMonth();
          }
        },
        _isIncrementMonth: Boolean,
        _isDecrementMonth: Boolean,

        _selectedYear: {
          type: Number,
          value: new Date().getFullYear()
        },
        _selectedMonth: {
          type: Number,
          value: new Date().getMonth()
        },
        _selectedDate: {
          type: Number,
          value: new Date().getDate()
        },

        _chosenDaysOfMonth: {
          type: Number,
          value: function() {
            return new Date().getDate();
          }
        },

        _isListRendered: {
          type: Boolean,
          value: !1
        },

        _isSelectedDateConfirmed: Boolean,
        _format: {
          type: Object,
          value: function() {
            return {y: 'yyyy', m: 'mm', d: 'dd', s1: '/', s2: '/'};
          }
        },

      },

      observers: [
        '_computeDaysOfMonth(_activeYear, _activeMonth, firstDayOfWeek, locale)',
        '_computeSeparateFormat(format)',
        '_computeShowLongDate(showLongDate, locale)',
        '_updateToReflectExternalChange(inputDate)',
        '_updateThemeColor(theme)',
        '_updateDatepickerView(view)',
        '_computeDaysOfWeek(firstDayOfWeek, locale)',
        '_computeActiveMonthYear(_activeYear, _activeMonth, locale)',
        '_computeShortSelectedDate(_selectedMonth, _selectedDate, locale)',
        '_computeShowSelectedYear(_selectedYear, locale)',
        '_computeShiftedDisableDays(firstDayOfWeek, disableDays.*)',
      ],

      // Element Lifecycle

      ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
        if (!window.Intl) {
          // var _hrefs = [ '../polyfill/moment.html', '../polyfill/intl.html' ];
          var _hrefs = [ 'intl.html' ];

          var _thisLocale = this.locale;
          var _thisActiveYear = this._activeYear;
          var _thisActiveMonth = this._activeMonth;
          var _thisSelectedYear = this._selectedYear;
          var _thisSelectedMonth = this._selectedMonth;
          var _thisSelectedDate = this._selectedDate;
          var _thisSet = this.set.bind(this);
          var _thisComputeDaysOfWeek = this._computeDaysOfWeek.bind(this);
          var _thisComputeActiveMonthYear = this._computeActiveMonthYear.bind(this);
          var _thisComputeShowSelectedYear = this._computeShowSelectedYear.bind(this);
          for (var i = 0; i < 2; i++) {
            Polymer.Base.importHref(_hrefs[i], function(ev) {
              _thisComputeDaysOfWeek(_thisLocale);
              _thisComputeActiveMonthYear(_thisActiveYear, _thisActiveMonth, _thisLocale);
              _thisComputeShortSelectedDate(_thisSelectedMonth, _thisSelectedDate, _thisLocale);
              _thisComputeShowSelectedYear(_thisSelectedYear, _thisLocale);
            }, function(err) {
              console.error(err);
            }, !0);
          }
        }else if (!window.Intl.DateTimeFormat().resolvedOptions().timeZone) {
          // Polymer.Base.importHref('../polyfill/moment.html', function(ev) {
          // }, function(err) {
          //   console.error(err);
          // }, !0);
        }

        // Set default value for date when created.
        var _defaultTimeWhenCreated = new Date();
        this.set('_selectedDate', _defaultTimeWhenCreated.getDate());
        this._computeShowLongDate(this.showLongDate, this.locale);
      },

      attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
        if (!this.noAnimation) {
          this.set('animationConfig', {
            'incrementEntry': [
              {
                name: 'slide-from-right-animation',
                node: this.$.daysOfWeek
              },
              {
                name: 'slide-from-right-animation',
                node: this.$.daysOfMonth
              },
              {
                name: 'datepicker-slide-from-right-animation',
                node: this.$.navMonthYear
              }
            ],
            'decrementEntry': [
              {
                name: 'slide-from-left-animation',
                node: this.$.daysOfWeek
              },
              {
                name: 'slide-from-left-animation',
                node: this.$.daysOfMonth
              },
              {
                name: 'datepicker-slide-from-left-animation',
                node: this.$.navMonthYear
              }
            ]
          });
          this.set('pageEntryAnimation', 'fade-in-animation');
          this.set('pageExitAnimation', 'fade-out-animation');
        }
        // setup distributed children.
        var _content = this.getEffectiveChildren();
        var _paperButtons = Polymer.dom(_content[0]).querySelectorAll('paper-button');
        // workaround to check for _content[0] as paper-button outside of
        // this element will be queried as well even though outside of content tag.
        if (_content[0] && _paperButtons.length > 0) {
          for (var i = 0; i < _paperButtons.length; i++) {
            // addEventListener to paper-button with dialog-confirm.
            if (_paperButtons[i].hasAttribute('dialog-confirm')) {
              // attach event handler which first binded to this scope.
              _paperButtons[i].addEventListener('tap', this._updateBindDate.bind(this));
              _paperButtons[i].addEventListener('transitionend', this._updateBindDate.bind(this));
            }
            // Polymer's polyfill for custom properties does not apply to distributed children.
            // https://www.polymer-project.org/1.0/docs/devguide/styling.html
            this._updateDistributedButtonInkColorCustomProp(_paperButtons[i], '#737373');
          }
          // update to a new height for datepicker if paper-buttons present.
          this.$.dp.classList.add('with-buttons');
        }else {
          this.$.dp.classList.remove('with-buttons');
        }

        this.fire('jv-datepicker-attached');
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },

      // Element Behavior

      //  Month Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
      //  Days   31  28  31  30  31  30  31  31  30  31  30  31
      //   31?    0       2       4       6   7       9      11
      //   30?                3       5           8      10
      //  Feb?        1
      //  Su Mo Tu We Th Fr Sa    startDay - _firstDayOfWeek
      //                  1  2        5 - 0 < 0 ? 6 : 5 - 0;
      //  Mo Tu We Th Fr Sa Su
      //               1  2  3        5 - 1 < 0 ? 6 : 5 - 1;
      //  Tu We Th Fr Sa Su Mo
      //            1  2  3  4        5 - 2 < 0 ? 6 : 5 - 2;
      //  We Th Fr Sa Su Mo Tu
      //         1  2  3  4  5        5 - 3 < 0 ? 6 : 5 - 3;
      //  Th Fr Sa Su Mo Tu We
      //      1  2  3  4  5  6        5 - 4 < 0 ? 6 : 5 - 4;
      //  Fr Sa Su Mo Tu We Th
      //   1  2  3  4  5  6  7        5 - 5 < 0 ? 6 : 5 - 5;
      //  Sa Su Mo Tu We Th Fr
      //                     1        5 - 6 < 0 ? 6 : 5 - 6;
      // Compute the days for a month.
      _computeDaysOfMonth: function(_activeYear, _activeMonth, _firstDayOfWeek, _locale) {
        // Compute total number of days for a month.
        function _computeTotalDaysOfMonth(_year, _month) {
          var _totalDaysOfMonth = 31;
          if (_month === 1) {
            _totalDaysOfMonth = new Date(_year, 1, 29).getMonth() === 1 ? 29 : 28;
          }else if (_month === 3 || _month === 5 || _month === 8 || _month === 10) {
            _totalDaysOfMonth = 30;
          }
          return _totalDaysOfMonth;
        }

        var _start = new Date(_activeYear, _activeMonth, 1).getDay();
        var _daysOfMonth = [];
        var _totalDays = _computeTotalDaysOfMonth(_activeYear, _activeMonth);

        //  if _firstDayOfWeek is greater than 0 but less than 7.
        if (_firstDayOfWeek > 0 && _firstDayOfWeek < 7) {
          _start = _start - _firstDayOfWeek;
          _start = _start < 0 ? 7  + _start : _start;
        }

        // Set up Intl.
        _locale = _locale || window.Intl.DateTimeFormat().resolvedOptions().locale;
        var _formatter = new window.Intl.DateTimeFormat(_locale, {
          day: 'numeric'
        }).format;
        for (var i = 0, j = 1 - _start; i < 42; i++, j++) {
          var _formatted = _formatter(new Date(_activeYear, _activeMonth, j));
          var _dateObj = {
            date: '',
            index: ''
          }
          if (i >= _start & i < _start + _totalDays) {
            _dateObj.date = _formatted;
            _dateObj.index = j;
          }
          _daysOfMonth.push(_dateObj);
        }

        // Update _chosenDaysOfMonth for every new calendar being rendered.
        this.set('_chosenDaysOfMonth', this._computeChosenDaysOfMonth(_daysOfMonth, this._selectedDate));

        // Update the old _daysOfMonth.
        this.set('_daysOfMonth', _daysOfMonth);
      },
      /// Re-compute disable days with firstDayOfWeek.
      _computeShiftedDisableDays: function(_firstDayOfWeek, _isDisableDays) {
        _firstDayOfWeek = _firstDayOfWeek > 0 && _firstDayOfWeek < 7 ? _firstDayOfWeek : 0;
        var _sdd = this.disableDays.map(function(_day) {
          _day = _day - _firstDayOfWeek;
          return _day < 0 ? 7 + _day : _day;
        });
        this.set('_shiftedDisableDays', _sdd);
      },

      // Increment the month via user interaction.
      _incrementMonth: function(ev) {
        this.debounce('_incrementMonth', function() {
          var _type = ev.type;
          if (_type === 'tap') {
            this.set('_isIncrementMonth', !0);
          }

          if (_type === 'transitionend' || this.noAnimation) {
            if (this._isIncrementMonth) {
              var _month = this._activeMonth;
              if (++_month > 11) {
                this._activeYear++;
                _month = 0;
              }
              this.set('_activeMonth', _month);

              if (!this.noAnimation) {
                this.cancelAnimation();
                this.playAnimation('incrementEntry');
              }
              this.set('_isIncrementMonth', !1);
            }
          }
        }, 1);
      },
      // Decrement the month via user interaction.
      _decrementMonth: function(ev) {
        this.debounce('_decrementMonth', function() {
          var _type = ev.type;
          if (_type === 'tap') {
            this.set('_isDecrementMonth', !0);
          }

          if (_type === 'transitionend' || this.noAnimation){
            if (this._isDecrementMonth) {
              var _month = this._activeMonth;
              if (--_month < 0) {
                this._activeYear--;
                _month = 11;
              }
              this.set('_activeMonth', _month);
              if (!this.noAnimation) {
                this.cancelAnimation();
                this.playAnimation('decrementEntry');
              }
              this.set('_isDecrementMonth', !1);
            }
          }
        }, 1);
      },

      // Re-compute active month year if new date is selected.
      _computeActiveMonthYear: function(_activeYear, _activeMonth, _locale) {
        if (window.Intl) {
          _locale = _locale || window.Intl.DateTimeFormat().resolvedOptions().locale;
          var _amy = new window.Intl.DateTimeFormat(_locale, {
            month: 'short',
            year: 'numeric'
          }).format(new Date(_activeYear, _activeMonth, 1));
          this.set('_activeMonthYear', _amy);
        }
      },
      // Re-compute short version of full date to show on the picker.
      _computeShortSelectedDate: function(_selectedMonth, _selectedDate, _locale) {
        if (window.Intl) {
          _locale = _locale || window.Intl.DateTimeFormat().resolvedOptions().locale;
          var _ssd = new window.Intl.DateTimeFormat(_locale, {
            weekday: 'short',
            month: 'short',
            day: 'numeric'
          }).format(new Date(this._selectedYear, _selectedMonth, _selectedDate));
          this.set('_shortSelectedDate', _ssd);
        }
      },
      _computeShowSelectedYear: function(_selectedYear, _locale) {
        if (window.Intl) {
          _locale = _locale || window.Intl.DateTimeFormat().resolvedOptions().locale;
          var _ssy = new window.Intl.DateTimeFormat(_locale, {
            year: 'numeric'
          }).format(new Date(_selectedYear, 0, 1));
          this.set('_showSelectedYear', _ssy);
        }
      },

      // When a day of month is selected, a lot of tasks need to be carried out.
      _chooseDaysOfMonth: function(ev) {
        var _target = ev.target;
        // daysOfMonth is chooseable when:
        // a) _target.date is of type Number,
        // b) _target.classList.contains('is-disabled-day').
        if (_target &&
            this._isNumber(_target.date) &&
            !_target.classList.contains('is-disabled-day')
          ) {
          // This will trigger _isChosenDaysOfMonth to recompute style.
          this.set('_chosenDaysOfMonth', _target.index);

          this.set('_selectedDate', _target.date);
          this.set('_selectedYear', this._activeYear);
          this.set('_selectedMonth', this._activeMonth);
        }
      },

      // Re-compute class when the item (day of month) is today's date.
      _isToday: function(_item, _activeYear, _activeMonth) {
        var _now = new Date();
        var _isToday = _item === _now.getDate() &&
                      _activeYear === _now.getFullYear() &&
                      _activeMonth === _now.getMonth()
        return _isToday ? ' is-today' : '';
      },
      // Re-compute class when the item (day of month) is empty date & non-selectable.
      _isEmptyDate: function(_item) {
        return this._isNumber(_item) ? '' : ' is-non-selectable';
      },
      // Re-compute class if the item (day of month) is the selected date.
      _isChosenDaysOfMonth: function(_item, _selectedYear, _selectedMonth, _selectedDate) {
        // able to retain selected daysOfMonth even after navigating to other months.
        var _isChosenDaysOfMonth = this._chosenDaysOfMonth >= 0 &&
                                   this._activeYear === _selectedYear &&
                                   this._activeMonth === _selectedMonth &&
                                   _item === _selectedDate;
        return _isChosenDaysOfMonth ? ' chosen-days-of-month' : '';
      },
      // Re-compute class if the item (day of month) is a disable day.
      _isDisableDays: function(_index, _shiftedDisableDays, _firstDayOfWeek, _minDate, _maxDate, _item) {
        var _isLessThanMinDate = null;
        var _isMoreThanMaxDate = null;
        var _isDisableDay = null;
        // _index % 7 gives values from 0 to 6.
        // and if _index matches some of these disableDays values return true.
        var _isDisableDays = this._shiftedDisableDays.some(function(_n) {
          return _n === _index % 7;
        });
        // ------ < _minDate ---------------- _maxDate > ------
        // if _item is of type Number.
        // if converted _item into new Date() < minDate or > maxDate.
        if (this._isNumber(_item)) {
          var _minDate = null;
          var _maxDate = null;
          var _minDateObj = this._computeMinDate(_minDate);
          var _maxDateObj = this._computeMaxDate(_maxDate);
          var _currentDate = new Date(this._activeYear, this._activeMonth, _item);
          // run two different obj differently just in case only one of them
          // is defined and still be able to update disabled days.
          if (!this._isUndefined(_minDateObj)) {
            _minDate = new Date(_minDateObj.year, _minDateObj.month - 1, _minDateObj.date);
            _isLessThanMinDate = _currentDate < _minDate;
          }
          if (!this._isUndefined(_maxDateObj)) {
            _maxDate = new Date(_maxDateObj.year, _maxDateObj.month - 1, _maxDateObj.date);
            _isMoreThanMaxDate = _currentDate > _maxDate;
          }
        }
        // To disable a date, it must be either one of the followings:
        // a) _isDisabledDays (set by property disableDays),
        // b) _isLessThanMinDate (set by property minDate), and
        // c) _isMoreThanMaxDate (set by propery moreDate).
        _isDisableDay = _isDisableDays || _isLessThanMinDate || _isMoreThanMaxDate;
        return _isDisableDay ? ' is-disabled-day is-non-selectable' : '';
      },

      // Re-compute class when a year is selected at year page.
      _isListOfYearsSelected: function(_itemYear, _activeYear) {
        return _itemYear === _activeYear ? ' is-selected' : '';
      },

      _computeDaysOfWeek: function(_firstDayOfWeek, _locale) {
        // _daysOfWeek needs to be changed as well with firstDayOfWeek and locale.
        var _dow = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        var _firstDayOfWeek = _firstDayOfWeek > 0 && _firstDayOfWeek < 7 ? _firstDayOfWeek : 0;

        // if locale is set and window.Intl is supported...
        if (_locale && window.Intl) {
          _dow = [];
          var _today = new Date();
          var _offsetDate = _today.getDate() - _today.getDay();
          for (var i = 0; i < 7; i++) {
            var _formatter = new window.Intl.DateTimeFormat(_locale, {
              weekday: 'narrow'
            }).format;
            _today = new Date(_today.getFullYear(), _today.getMonth(), _offsetDate + i);
            _dow.push(_formatter(_today));
          }
        }

        var _sliced = _dow.slice(_firstDayOfWeek);
        var _rest = _dow.slice(0, _firstDayOfWeek);
        var _concatted = Array.prototype.concat(_sliced, _rest);
        this.set('_daysOfWeek', _concatted);
      },
      // Re-compute the index of the selected date when a new date is selected
      // via user interaction.
      _computeChosenDaysOfMonth: function(_daysOfMonth, _selectedDate) {
        // depends on _daysOfMonth and recalculate the index of _chosenDaysOfMonth.
        var _len = _daysOfMonth.length;
        for (var i = 0; i < _len; i++) {
          if (i >= 0 && _daysOfMonth[i].index === _selectedDate) {
            return i;
          }
        }
      },

      // Get date from date string as the minimum date can be selected.
      _computeMinDate: function(_minDate) {
        return this._extractDateToParts(_minDate);
      },
      // Get date from date string as the maximum date can be selected.
      _computeMaxDate: function(_maxDate) {
        return this._extractDateToParts(_maxDate);
      },
      // Extract date from the date string.
      _extractDateToParts: function(_dateString) {
        if (!_dateString instanceof Date && typeof _dateString === 'string') {
          var re = /(\d{4})[^a-zA-Z0-9]+(\d{2})[^a-zA-Z0-9]+(\d{2})/i;
          var m = re.exec(_dateString);
          if (m !== null) {
            return {year: parseFloat(m[1]), month: parseFloat(m[2]), date: parseFloat(m[3])};
          }
        }else if (_dateString instanceof Date &&
                  new Date(_dateString).toDateString() !== 'Invalid Date') {
          return {
            year: _dateString.getFullYear(),
            month: _dateString.getMonth() + 1,
            date: _dateString.getDate()
          }
        }
      },

      // Dynamically load items into the iron-list when switching page to year view.
      _updateList: function(_activeView) {
        for (var _newList = [], y = 1900, i = y; i <= 2100; i++) {
          _newList.push({ year: i });
        }
        this.set('_listOfYears', _newList);
      },
      // On neon-animaition-finish, udpate scroller position of the iron-list.
      // It is to fix the iron-list so that the selected year will always be centered by
      // hardcoded with fixed length of #items.
      _onAnimationFinish: function(ev) {
        var _target = ev.detail;
        // TO fix the scrolling of iron-list, hard coded with fixed length of #items.
        if (_target && _target.toPage.tagName === 'IRON-LIST') {
          this._updateListScroller(_target.toPage);
        }
      },
      _updateListScroller: function(_list) {
        var _sl = Polymer.dom(_list.root).querySelector('#items');
        var _slh = _sl.getBoundingClientRect().height || 12863.994140625;
        var _sli = Math.floor(_slh / (2100 - 1900 + 1) * (this._activeYear - 1900 - 2)) + 1;

        // Adjust center position when datepickers has no buttons and in landscape mode.
        if (!this.$.dp.classList.contains('with-buttons') &&
            window.matchMedia('(orientation: landscape)').matches) {
          _sli = Math.floor(_slh / (2100 - 1900 + 1) * (this._activeYear - 1900 - 1)) + 1;
        }

        // Scroll to selected year.
        this.async(function() {
          _list.scroll(0, _sli);
        }, 17); // wait for at least 17ms to update the scroller position.
      },
      // When first time switching page to year view, dynamically render iron-list.
      _onIronSelectorSelectedChanged: function(ev) {
        if (ev.detail.value === 'year') {
          if (!this._isListRendered) {
            this._updateList();
            this.set('_isListRendered', !0);
          }else {
            // When noAnimation is truthy, this will update the list scroller.
            if (this.noAnimation) {
              this._updateListScroller(this.$$('#listOfYears'));
            }
          }
        }
      },
      _onListRendered: function(ev) {
        // When noAnimation is truthy, this will update the list scroller.
        if (ev.target.if && this.noAnimation) {
          this.async(function() {
            this._updateListScroller(this.$$('#listOfYears'));
          }, 1);
        }
      },
      _goCalendar: function(ev) {
        var _selectedYear = ev.model.item.year;
        // Set _activeYear and _selectedYear to the selected year.
        this.set('_activeYear', _selectedYear);
        this.set('_selectedYear', _selectedYear);
        // Go back to calendar page.
        this.set('_activeView', 'calendar');
      },

      // split capturing group of format into year, month and date.
      _computeSeparateFormat: function(_format) {
        var re = /(yyyy|yy)[^a-zA-Z0-9]+(mmmm|mmm|mm|m)[^a-zA-Z0-9]+(do|dd|d)/i;
        var sym = /\w+([^a-zA-Z0-9]+)\w+([^a-zA-Z0-9]+)\w+/i;
        var m = re.exec(_format);
        var n = sym.exec(_format);
				var _temp = {};
		    if (m !== null && n !== null) {
					_temp.y = m[1];
					_temp.m = m[2];
					_temp.d = m[3];
					_temp.s1 = n[1];
					_temp.s2 = n[2];
		    }
				this.set('_format', _temp);
				_temp = null;
      },

      // bind the selected date so that it's ready to be read from the outside world.
      _bindSelectedFulldate: function(_selectedYear, _selectedMonth, _selectedDate, _format) {
				// show long date (eg. Fri, May 12 2017 instead.
        if (this.showLongDate) {
          return this._computeShowLongDate(this.showLongDate, _selectedDate, this.locale, !0);
        }

				var _formattedYear  = _selectedYear;
				var _formattedMonth  = this._monthNames[_selectedMonth];
				var _formattedDate  = _selectedDate;
				var _finalFormatted = '';
        // compute new formatted year.
        if (_format.y === 'yy') {
          _formattedYear = _selectedYear%100;
        }
        // compute new formatted month.
        if (_format.m === 'mmm') {
          _formattedMonth = _formattedMonth.slice(0, 3);
        }else if (_format.m === 'mm') {
          _formattedMonth = this._padStart(_selectedMonth + 1, 2, '0');
        }else if (_format.m === 'm') {
          _formattedMonth = _selectedMonth + 1;
        }
        // compute new formatted date.
        if (_format.d === 'do') {
          var _cardinalNumber = _formattedDate%10;
          var _suffixOrdinal = _cardinalNumber > 3 ? 'th' :
            ['th', 'st', 'nd', 'rd'][_cardinalNumber];
          if (_formattedDate === 11 || _formattedDate == 12 || _formattedDate === 13) {
            _suffixOrdinal = 'th';
          }
          _formattedDate = _formattedDate + _suffixOrdinal;
        }else if (_format.d === 'dd') {
          _formattedDate = this._padStart(_formattedDate, 2, '0');
        }
        // set formatted value with user defined symbols.
        _finalFormatted = _formattedYear + _format.s1 +
                          _formattedMonth + _format.s2 + _formattedDate;

				return _finalFormatted;
      },
      // method for content tag (eg. buttons).
      _updateBindDate: function(ev) {
        this.debounce('_updateBindDate', function() {
          var _type = ev.type;
          if (_type === 'tap') {
            this.set('_isSelectedDateConfirmed', !0);
          }

          if (_type === 'transitionend' || this.noAnimation){
            if (this._isSelectedDateConfirmed) {
              var _sy = this._selectedYear;
              var _sm = this._selectedMonth;
              var _sd = this._selectedDate;
              var _f = this._format
              var _confirmDate = this._bindSelectedFulldate(_sy, _sm, _sd, _f);
              this._setDate(_confirmDate);
              this.set('_isSelectedDateConfirmed', !1);
            }
          }
        }, 1);
      },
      // Update date to show long date or short date.
      _computeShowLongDate: function(_showLongDate, _locale, _returnResult) {
        if (this._isUndefined(this._selectedDate)) {
          return;
        }

        var _selectedDate = this._selectedDate;
        var _longDate = new Date(this._selectedYear, this._selectedMonth, _selectedDate);

        if (_showLongDate) {
          _locale = _locale || window.Intl.DateTimeFormat().resolvedOptions().locale;
          var _options = {
            weekday: this.showLongDate ? 'short' : undefined,
            year: 'numeric',
            month: this.showLongDate ? 'short' : '2-digit',
            day: '2-digit'
          };
          _longDate = new window.Intl.DateTimeFormat(_locale, _options).format(_longDate);

          if (_returnResult) {
            return _longDate;
          }

          // Fix for notorious IE - add unknown spaces (%E2%80%8E) when formatting date with Intl.
          // http://utf8-chartable.de/unicode-utf8-table.pl?start=8192&number=128
          if (window.navigator.msManipulationViewsEnabled) {
            if (_locale || _locale === '') {
              _longDate = decodeURIComponent(encodeURIComponent(_longDate).replace(/\%E2\%80\%8[0-9A-F]/gi, ''));
            }
          }

          this._setDate(_longDate);
        }else {
          _longDate = this._bindSelectedFulldate(this._selectedYear,
            this._selectedMonth, _selectedDate, this._format);

          if (_returnResult) {
            return _longDate;
          }

          this._setDate(_longDate);
        }
      },

      // TO make things simple and works across different browsers, the input date string
      // has to be standardized - YYYY/MM/DD.
      // http://dygraphs.com/date-formats.html
      _updateToReflectExternalChange: function(_inputDate) {
        // Only locale with 'en' is accepted.
        if (this.locale.indexOf('en') < 0 || this.locale === '') {
          this._setInvalidDate(!0);
          return;
        }
        // accepted input date string:
        // 1. 2016 January 31
        // 2. 2016 January 3
        // 3. 2016 Jan 31
        // 4. 2016 Jan 3
        // 5. 2016/13/13
        function _isValidDate(_id, _showLongDate) {
          var _res = {
            valid: !1,
            result: ''
          };
          // Check if long input date is a valid date.
          if (_showLongDate) {
            var _ds = _id.split(', ');
            if (_ds.length > 2) {
              _ds = _ds[1].split(' ').join('/') + ', ' + _ds[2];
              var _newDate = new Date(_ds);
              if (_newDate.toString() === 'Invalid Date') {
                return _res;
              }else {
                return {
                  valid: !0,
                  result: _newDate
                };
              }
            }

            return _res;
          }

          // From here onwards, to check for short input date.
          var _re1 = /^(\d{4})[\/](\d{1,2})[\/](\d{1,2})$/i;
          var _re2 = /^(\d{4})[ ](\w+)[ ](\d{1,2})$/i;

          var _validWithRe1 = _re1.exec(_id);
          var _validWithRe2 = _re2.exec(_id);

          if (_validWithRe1 === null && _validWithRe2 === null) {
            return _res;
          }else {
            var _resultToDate = null;
            if (_validWithRe1 === null) {
              _resultToDate = new Date(_validWithRe2[1] + ' ' + _validWithRe2[2] + ' ' + _validWithRe2[3]);
            }else if (_validWithRe2 === null) {
              _resultToDate = new Date(_validWithRe1[1], _validWithRe1[2] - 1, _validWithRe1[3]);
            }

            return {
              valid: !0,
              result: _resultToDate
            };
          }
        }

        var _showLongDate = this.showLongDate;
        var _yy = 0;
        var _mm = 0;
        var _dd = 0;
        var _isValidDate = _isValidDate(_inputDate, _showLongDate);

        if (_isValidDate.valid) {
          var _vd = new Date(_isValidDate.result);
          var _yy = _vd.getFullYear();
          var _mm = _vd.getMonth();
          this._setInvalidDate(!1);

          this.set('_activeYear', _yy);
          this.set('_activeMonth', _mm);
          this.set('_selectedYear', _yy);
          this.set('_selectedMonth', _mm);
          this.set('_selectedDate', _vd.getDate());
        }else {
          this.set('_selectedDate', this._selectedDate || new Date().getDate());
          this._computeShowLongDate(_showLongDate, this.locale);
          this._setInvalidDate(!0);
        }
      },
      /**
       * By default, buttons are required so that they are to confirm the date change.
       * This method allows force update the datepicker when there are no buttons inside the datepicker to confirm date change.
       */
      enforceDateChange: function() {
        this._setInvalidDate(!1);
        this._computeShowLongDate(this.showLongDate, this.locale);
      },

      // Lodash's replacements.
      _padStart: function(_string, _length, _chars) {
        var _len = -_length;
        var _str = (_chars + _string).slice(_len);
        return _str;
      },
      _isUndefined: function(_value) {
        return _value === undefined;
      },
      _isNumber: function(_value) {
        // return typeof _value == 'number' || (!Number.isNaN(parseFloat(_value)) && Number.isFinite(_value));
        // Fallback: caused by IE11 as those methods are not supported in IE11.
        return typeof _value == 'number' || (!isNaN(parseFloat(_value)) && isFinite(_value));
      },

      // Update theme color.
      _updateThemeColor: function(_theme) {
        var _themes = ['dark-theme', 'light-theme', 'goog-theme'];
        var _themeIdx = _themes.indexOf(_theme);
        var _distributedButtons = Polymer.dom(this).querySelectorAll('paper-button');
        var _distributedButtonsLen = _distributedButtons.length;
        var _colorCode = ['#bcbcbc', '#737373', '#616161'][_themeIdx];

        if (_themeIdx >= 0) {
          _themes.splice(_themeIdx, 1);

          this.toggleClass(_themes[0], !1, this);
          this.toggleClass(_themes[1], !1, this);
          this.toggleClass(_theme, !0, this);
        }else {
          this.toggleClass('dark-theme', !1, this);
          this.toggleClass('light-theme', !1, this);
          this.toggleClass('goog-theme', !1, this);
        }

        // workaround to update custom property of distributed buttons.
        for (var i = 0; i < _distributedButtonsLen; i++) {
          this._updateDistributedButtonInkColorCustomProp(_distributedButtons[i], _colorCode || '#737373');
        }
        // Update styles of the whole datepicker.
        this.updateStyles();
      },
      // Forcefully update the view of the datepicker.
      _updateDatepickerView: function(_view) {
        this.toggleClass('horizontal-view', _view === 'horizontal', this);
        this.toggleClass('vertical-view', _view === 'vertical', this);
      },

      // workaround to update custom property of distributed children until Polymer supports Native custom properties.
      _updateDistributedButtonInkColorCustomProp: function(_node, _colorCode) {
        _node.customStyle['--paper-button-ink-color'] = _colorCode;
        _node.updateStyles();
      },

      // TODO: To add GIF to README.md.
      // TODO: To migrate 2nd datepicker to the same month when minDate is set on the 1st datepicker.
      // TODO: Input date with showLongDate will accept only format only.
      // X - TODO: Add supported browsers.
      // X - TODO: User Intl for locales.
      // X - TODO: Added polyfill for browsers without Intl.
      // X - TODO: DRY up again.
      // X - TODO: Fixed centering of selected year in the iron-list by hardcoded with fixed length of #items.
      // X - TODO: To add dist/ to contain minified version.
      // X - TODO: Templatize datepicker so that reduce element nodes on page load.
      // X - TODO: Added dark, goog theme.
      // X - TODO: Special method to update two-way binded read-only property.
      // X - TODO: To add property noAnimation to disable all animations completely.
      // X - TODO: To allow custom animation configurations.
      // X - TODO: Tap and Transition within the same method FTW.
      // X - TODO: input date will reflect the change to update internal datepicker.
      // X - TODO: paper-buttons are way too big. Set font-size to 14px instead (It was set to 12px so this is no need).
      // X - TODO: To add support for IE11, div.days-of-month can be fixed by removing padding: 0 3px at @media & font seems too large, no user-select none.
    });
  </script>
</dom-module>
